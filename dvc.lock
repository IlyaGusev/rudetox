schema: '2.0'
stages:
  download:
    cmd: bash scripts/download_datasets.sh
    deps:
    - path: scripts/download_datasets.sh
      md5: f75a0fa9e5a8e338bef1de28a1624169
      size: 2399
    outs:
    - path: data/2ch.csv
      md5: e04d99ca44f5172ade13997ce09f3aea
      size: 4669913
    - path: data/bad_vocab.txt
      md5: 4205eafcfef0eefad951d977bdd65de6
      size: 3720943
    - path: data/detox_dev.tsv
      md5: 561fea58685d9fb7b664000bf2616afe
      size: 200691
    - path: data/detox_train.tsv
      md5: 54bcbb21ea703da28ba719ac4f1ac2d9
      size: 1902888
    - path: data/koziev.txt
      md5: b36d51f0752b40e68896c60aea2009fb
      size: 139208644
    - path: data/ok.ft
      md5: 5fdcf4cdcb449616c6f42b3efe100557
      size: 39268580
    - path: data/persona.tsv
      md5: 0fe4899e0bd5dcc4cfc9e4a4a1401ffe
      size: 37431241
      isexec: true
    - path: data/seq2seq_gen.jsonl
      md5: bf1b68daa41ee8b751f84445960890b9
      size: 5865769
    - path: data/seq2seq_gen_train.jsonl
      md5: 2bb2c87af47f6a26de1531c064fa322e
      size: 5128497
    - path: data/seq2seq_gen_val.jsonl
      md5: 692e08901f818fd5c67b3cfef4f514a1
      size: 737272
  prepare_seq2seq:
    cmd: bash scripts/prepare_seq2seq_dataset.sh
    deps:
    - path: data/detox_dev.tsv
      md5: 561fea58685d9fb7b664000bf2616afe
      size: 200691
    - path: data/detox_train.tsv
      md5: 54bcbb21ea703da28ba719ac4f1ac2d9
      size: 1902888
    - path: data/seq2seq_gen.jsonl
      md5: bf1b68daa41ee8b751f84445960890b9
      size: 5865769
    - path: data/seq2seq_gen_train.jsonl
      md5: 2bb2c87af47f6a26de1531c064fa322e
      size: 5128497
    - path: data/seq2seq_gen_val.jsonl
      md5: 692e08901f818fd5c67b3cfef4f514a1
      size: 737272
    - path: rudetox/seq2seq/converters/detox.py
      md5: f7fc42ec75f32b6f0a03e646321ccf6f
      size: 1938
    outs:
    - path: data/seq2seq_train.jsonl
      md5: b5e719acb1811503c11e626f71270a07
      size: 2574192
    - path: data/seq2seq_united_train.jsonl
      md5: 70d041d215f7c828f8213078b9ada481
      size: 8439961
    - path: data/seq2seq_val.jsonl
      md5: 88b5fcf9da5b5d93129557c57754d3b9
      size: 271171
  prepare_seq2seq_dataset:
    cmd:
    - python3 -m rudetox.seq2seq.converters.detox --input-file data/detox_train.tsv
      --output-file data/seq2seq_train.jsonl
    - python3 -m rudetox.seq2seq.converters.detox --input-file data/detox_dev.tsv
      --output-file data/seq2seq_val.jsonl
    - python3 -m rudetox.seq2seq.converters.detox --input-file data/detox_train.tsv
      --output-file data/seq2seq_train_extended.jsonl --include-auto-neutrals --include-auto-toxic
      --include-reverse
    - python3 -m rudetox.seq2seq.converters.detox --input-file data/detox_dev.tsv
      --output-file data/seq2seq_val_extended.jsonl --include-auto-neutrals --include-auto-toxic
      --include-reverse
    - python3 -m rudetox.seq2seq.converters.detox --input-file data/detox_test.tsv
      --output-file  data/seq2seq_test.jsonl
    - python3 -m rudetox.seq2seq.augment --input-path data/seq2seq_train.jsonl --output-path
      data/seq2seq_train_aug.jsonl --config-path configs/seq2seq_augmentations.json
      --bad-vocab-path data/bad_vocab.txt
    - python3 -m rudetox.seq2seq.augment --input-path data/seq2seq_val.jsonl --output-path
      data/seq2seq_val_aug.jsonl --config-path configs/seq2seq_augmentations.json
      --bad-vocab-path data/bad_vocab.txt
    deps:
    - path: configs/seq2seq_augmentations.json
      md5: 95a53a4f790113696d2d6e67d1472ab3
      size: 428
    - path: data/bad_vocab.txt
      md5: 4205eafcfef0eefad951d977bdd65de6
      size: 3720943
    - path: data/detox_dev.tsv
      md5: 561fea58685d9fb7b664000bf2616afe
      size: 200691
    - path: data/detox_test.tsv
      md5: fa30444821c2fe040b153dd091ada9ba
      size: 104462
    - path: data/detox_train.tsv
      md5: 54bcbb21ea703da28ba719ac4f1ac2d9
      size: 1902888
    - path: rudetox/seq2seq/augment.py
      md5: 8f0fdf8d9276cc9649b0bca90d7e6d5a
      size: 1947
    - path: rudetox/seq2seq/converters/detox.py
      md5: 4f2850987fa6759c6531cd301d7e1650
      size: 2407
    outs:
    - path: data/seq2seq_test.jsonl
      md5: c81c4f9dd2aaf17a53cbaa34c0f396b5
      size: 116698
    - path: data/seq2seq_train.jsonl
      md5: f8b70a6540bf8f9d62ad249aedd7a769
      size: 2750606
    - path: data/seq2seq_train_aug.jsonl
      md5: dc48680faeee8c2f34c53d9e9c74bfd5
      size: 4968794
    - path: data/seq2seq_train_extended.jsonl
      md5: a96c49f09ea13e808a32e8dec2077093
      size: 12255732
    - path: data/seq2seq_val.jsonl
      md5: 011934462164931fc36367fe09657edb
      size: 278212
    - path: data/seq2seq_val_aug.jsonl
      md5: cdab3ce167df1101d1a6555ce7aca8e8
      size: 490832
    - path: data/seq2seq_val_extended.jsonl
      md5: 3f515fd5f00b16c066fc43c4d4abaa9a
      size: 1197854
  prepare_clf_dataset:
    cmd:
    - bash scripts/prepare_clf_dataset.sh
    deps:
    - path: configs/augmentations.json
      md5: ed14d395a71080272703f8d489c1a6b2
      size: 1001
    - path: data/2ch.csv
      md5: e04d99ca44f5172ade13997ce09f3aea
      size: 4669913
    - path: data/bad_vocab.txt
      md5: 4205eafcfef0eefad951d977bdd65de6
      size: 3720943
    - path: data/detox_train.tsv
      md5: 54bcbb21ea703da28ba719ac4f1ac2d9
      size: 1902888
    - path: data/koziev.txt
      md5: b36d51f0752b40e68896c60aea2009fb
      size: 139208644
    - path: data/ok.ft
      md5: 5fdcf4cdcb449616c6f42b3efe100557
      size: 39268580
    - path: data/persona.tsv
      md5: 0fe4899e0bd5dcc4cfc9e4a4a1401ffe
      size: 37431241
    - path: rudetox/clf/augment.py
      md5: 804284a2c6d5e9b59210513de4e154d9
      size: 2304
    - path: rudetox/clf/clean.py
      md5: 561e23ba9bffc7c59d1996a6cc05e70c
      size: 3051
    - path: rudetox/clf/converters/2ch.py
      md5: 7df179aa207e307b1a303a4f99954b52
      size: 803
    - path: rudetox/clf/converters/detox.py
      md5: 3bb51f15f16b8445fb2cd7ff3d4f1739
      size: 1183
    - path: rudetox/clf/converters/koziev.py
      md5: 29bfd24b544fb39fd89c33579285faac
      size: 1282
    - path: rudetox/clf/converters/ok.py
      md5: 2089bad819d60360f722b6f0b419f158
      size: 923
    - path: rudetox/clf/converters/persona.py
      md5: 686b1199e23a9283a9b6f2199022e2a6
      size: 2726
    - path: rudetox/clf/merge_all.py
      md5: ddb7b7202b8ee6264b58f68b5535a9f2
      size: 512
    - path: rudetox/clf/split.py
      md5: a66b234d820fe82efcfbe1058f0aa373
      size: 1473
    - path: scripts/prepare_clf_dataset.sh
      md5: 5188ab6d8a608bfb8aee1d267b0125e9
      size: 2832
    outs:
    - path: data/clf_all.jsonl
      md5: 9b9b63cbec51f1ebb2301c59d32937bb
      size: 65202290
    - path: data/clf_test.jsonl
      md5: 75d3f79d596d4be24217ed1d6fa97b39
      size: 6512377
    - path: data/clf_train.jsonl
      md5: a98ebad5a8bd6464c6cd5d5ccb441a5e
      size: 52185343
    - path: data/clf_train_aug.jsonl
      md5: ab744d053eab22900078d8e7a92aaf84
      size: 87236380
    - path: data/clf_val.jsonl
      md5: 7579fb2318a6324cccdd61397c8a15ca
      size: 6504570
    - path: data/clf_val_aug.jsonl
      md5: 757cecb283a7cdcd8a72f196dfd719ed
      size: 10862511
  download_data:
    cmd: bash scripts/download_datasets.sh
    deps:
    - path: scripts/download_datasets.sh
      md5: 4c253c257eedd8504dc0665a3b0500eb
      size: 2590
    outs:
    - path: data/2ch.csv
      md5: e04d99ca44f5172ade13997ce09f3aea
      size: 4669913
    - path: data/bad_vocab.txt
      md5: 4205eafcfef0eefad951d977bdd65de6
      size: 3720943
    - path: data/detox_dev.tsv
      md5: 561fea58685d9fb7b664000bf2616afe
      size: 200691
    - path: data/detox_test.tsv
      md5: fa30444821c2fe040b153dd091ada9ba
      size: 104462
    - path: data/detox_train.tsv
      md5: 54bcbb21ea703da28ba719ac4f1ac2d9
      size: 1902888
    - path: data/koziev.txt
      md5: b36d51f0752b40e68896c60aea2009fb
      size: 139208644
    - path: data/ok.ft
      md5: 5fdcf4cdcb449616c6f42b3efe100557
      size: 39268580
    - path: data/persona.tsv
      md5: 0fe4899e0bd5dcc4cfc9e4a4a1401ffe
      size: 37431241
      isexec: true
    - path: data/seq2seq_gen.jsonl
      md5: bf1b68daa41ee8b751f84445960890b9
      size: 5865769
    - path: data/seq2seq_gen_train.jsonl
      md5: 2bb2c87af47f6a26de1531c064fa322e
      size: 5128497
    - path: data/seq2seq_gen_val.jsonl
      md5: 692e08901f818fd5c67b3cfef4f514a1
      size: 737272
  train_seq2seq:
    cmd:
    - mkdir -p models
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.seq2seq.train --config-path configs/rut5_detox.json
      --train-path data/seq2seq_train_aug.jsonl --val-path data/seq2seq_val_aug.jsonl
      --out-dir models/rut5_detox --source-field "source" --target-field "target"
    - rm -rf models/rut5_detox/checkpoint*
    deps:
    - path: configs/rut5_detox.json
      md5: 2b63d05ccde7d330ac9505be19da5859
      size: 357
    - path: data/seq2seq_train_aug.jsonl
      md5: b4818929fa3027d8433dfa07b251cf67
      size: 5080676
    - path: data/seq2seq_val_aug.jsonl
      md5: f4b50e2922b443455d8fe63ab411db4f
      size: 501878
    - path: models/rut5_base
      md5: 55b9f4dd25232b66679eac6599c954cd.dir
      size: 1785504758
      nfiles: 5
    - path: rudetox/seq2seq/train.py
      md5: e8d9474ddd2ea539e59399599f64c58e
      size: 5900
    outs:
    - path: models/rut5_detox
      md5: b10ebc560595eb0e92b7c85c5caf366d.dir
      size: 894340433
      nfiles: 6
  download_models:
    cmd:
    - mkdir -p models
    - rm -rf models/style models/sim models/fluency models/en_ru models/ru_en models/rubertconv
      models/rut5_base
    - git clone https://huggingface.co/SkolkovoInstitute/russian_toxicity_classifier
      models/style
    - git clone https://huggingface.co/cointegrated/LaBSE-en-ru models/sim
    - git clone https://huggingface.co/SkolkovoInstitute/rubert-base-corruption-detector
      models/fluency
    - git clone https://huggingface.co/facebook/wmt19-en-ru models/en_ru
    - git clone https://huggingface.co/facebook/wmt19-ru-en models/ru_en
    - git clone https://huggingface.co/DeepPavlov/rubert-base-cased-conversational
      models/rubertconv
    - git clone https://huggingface.co/sberbank-ai/ruT5-base models/rut5_base
    outs:
    - path: models/en_ru
      md5: c75ee06cb983aee6746852dedbdf7d78.dir
      size: 2331339497
      nfiles: 8
    - path: models/fluency
      md5: b87680d0b29abad2d1d6e86b7a069c11.dir
      size: 1429163290
      nfiles: 8
    - path: models/ru_en
      md5: 91193bd60ed73de12be0842b904a4d76.dir
      size: 2331431203
      nfiles: 8
    - path: models/rubertconv
      md5: 614b2bd67865bec9980a51d7a01a898f.dir
      size: 2859314544
      nfiles: 8
    - path: models/rut5_base
      md5: 55b9f4dd25232b66679eac6599c954cd.dir
      size: 1785504758
      nfiles: 5
    - path: models/sim
      md5: 8ce77c006f00d3b556b7fe56ea996ef2.dir
      size: 1032948918
      nfiles: 7
    - path: models/style
      md5: a0a33176042b4f48cbd8c04e906819eb.dir
      size: 2848489352
      nfiles: 9
  predict_seq2seq:
    cmd:
    - mkdir -p predictions
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.seq2seq.predict --input-file data/seq2seq_test.jsonl
      --output-file predictions/rut5_detox_ranker.jsonl --model-name models/rut5_detox
      --num-beams 4 --num-return-sequences 4 --batch-size 4 --ranker-config configs/ranker.json
    deps:
    - path: configs/ranker.json
      md5: cf587a4609acb5729f392d7e70639806
      size: 210
    - path: data/seq2seq_test.jsonl
      md5: 8996c77794e261d46c06f4110148d58b
      size: 132448
    - path: models/fluency
      md5: b87680d0b29abad2d1d6e86b7a069c11.dir
      size: 1429163290
      nfiles: 8
    - path: models/rut5_detox
      md5: b10ebc560595eb0e92b7c85c5caf366d.dir
      size: 894340433
      nfiles: 6
    - path: models/sim
      md5: 8ce77c006f00d3b556b7fe56ea996ef2.dir
      size: 1032948918
      nfiles: 7
    - path: rudetox/seq2seq/predict.py
      md5: 8c5a628032296700ecd8ae78026ae8e7
      size: 4251
    outs:
    - path: predictions/rut5_detox_ranker.jsonl
      md5: 90f2523ef1408173438a49d399cf345e
      size: 510919
  train_clf:
    cmd:
    - mkdir -p models
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.clf.train --config-path configs/rubertconv_toxic_clf.json
      --train-path data/clf_train_aug.jsonl --val-path data/clf_val_aug.jsonl --test-path
      data/clf_test.jsonl --out-dir models/rubertconv_toxic_clf
    - rm -rf models/rubertconv_toxic_clf/checkpoint*
    deps:
    - path: configs/rubertconv_toxic_clf.json
      md5: 3baa7731fe82e1ead0f98d8a2d9826ce
      size: 436
    - path: data/clf_test.jsonl
      md5: 75d3f79d596d4be24217ed1d6fa97b39
      size: 6512377
    - path: data/clf_train_aug.jsonl
      md5: ab744d053eab22900078d8e7a92aaf84
      size: 87236380
    - path: data/clf_val_aug.jsonl
      md5: 757cecb283a7cdcd8a72f196dfd719ed
      size: 10862511
    - path: rudetox/clf/train.py
      md5: a97064afd748bbc68424f2f505bbe3bf
      size: 5796
    outs:
    - path: models/rubertconv_toxic_clf
      md5: eb13acc4bdbd0f7ee460cb1b97fcd409.dir
      size: 715113322
      nfiles: 6
  check_clf:
    cmd:
    - mkdir -p reports
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.clf.check --model-name models/rubertconv_toxic_clf
      --test-path data/clf_test.jsonl --toxic-vocab-path data/bad_vocab.txt --sample-rate
      0.1 --save-path reports/clf_suite.pkl
    deps:
    - path: data/bad_vocab.txt
      md5: 4205eafcfef0eefad951d977bdd65de6
      size: 3720943
    - path: data/clf_test.jsonl
      md5: 75d3f79d596d4be24217ed1d6fa97b39
      size: 6512377
    - path: models/rubertconv_toxic_clf
      md5: eb13acc4bdbd0f7ee460cb1b97fcd409.dir
      size: 715113322
      nfiles: 6
    - path: rudetox/clf/check.py
      md5: a72f6af50cb0c145f4c9dd1ffbf9184b
      size: 5968
    outs:
    - path: reports/clf_suite.pkl
      md5: 6062d80f7aece5ea4092b6fc8d669fed
      size: 5051486
  sample_non_toxic:
    cmd:
    - python3 -m rudetox.sample data/clf_all.jsonl data/non_toxic.jsonl --config-path
      configs/non_toxic_sampler.json
    deps:
    - path: configs/non_toxic_sampler.json
      md5: c98ed8d2e51510719c7adae09a1ce839
      size: 102
    - path: data/clf_all.jsonl
      md5: 1544f4e7f87164e3af00b8b4e4eb1fdc
      size: 72412309
    outs:
    - path: data/non_toxic.jsonl
      md5: 4987f3e05610584f9946d05d54c0b85a
      size: 42736007
  sample_toxic:
    cmd:
    - python3 -m rudetox.sample data/clf_all.jsonl data/toxic.jsonl --config-path
      configs/toxic_sampler.json
    deps:
    - path: configs/toxic_sampler.json
      md5: ee89a186c0cd3e055228ecde8bf94b71
      size: 91
    - path: data/clf_all.jsonl
      md5: 9b9b63cbec51f1ebb2301c59d32937bb
      size: 65202290
    - path: rudetox/sample.py
      md5: ed6a435cfefbce2ecac1599d94cd47d4
      size: 1351
    outs:
    - path: data/toxic.jsonl
      md5: b2b2f755c76fecdd3d29952907a5e663
      size: 6260409
  sample_neutral:
    cmd:
    - python3 -m rudetox.sample data/clf_all.jsonl data/neutral.jsonl --config-path
      configs/neutral_sampler.json
    deps:
    - path: configs/neutral_sampler.json
      md5: c98ed8d2e51510719c7adae09a1ce839
      size: 102
    - path: data/clf_all.jsonl
      md5: 1544f4e7f87164e3af00b8b4e4eb1fdc
      size: 72412309
    - path: rudetox/sample.py
      md5: ed6a435cfefbce2ecac1599d94cd47d4
      size: 1351
    outs:
    - path: data/neutral.jsonl
      md5: 4987f3e05610584f9946d05d54c0b85a
      size: 42736007
  gen_toxic2neutral_backtrans:
    cmd:
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.backtrans data/toxic.jsonl data/backtrans_toxic2neutral.jsonl
      --num-beams 5 --forward-model-name models/ru_en --backward-model-name models/en_ru
    deps:
    - path: data/toxic.jsonl
      md5: 5bb0818ee5cb8ae3ab57af9e209bcdc3
      size: 6357161
    - path: models/en_ru
      md5: c75ee06cb983aee6746852dedbdf7d78.dir
      size: 2331339497
      nfiles: 8
    - path: models/ru_en
      md5: 91193bd60ed73de12be0842b904a4d76.dir
      size: 2331431203
      nfiles: 8
    - path: rudetox/backtrans.py
      md5: 52bde97799484d581d0f2923027927a1
      size: 4364
    outs:
    - path: data/backtrans_toxic2neutral.jsonl
      md5: 2bb1f51d31d2e8c5eea9a72ecd360e1f
      size: 210864508
  rank_toxic2neutral_backtrans:
    cmd:
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.ranker data/backtrans_toxic2neutral.jsonl
      data/backtrans_toxic2neutral_ranked.jsonl --config-path configs/ranker.json
      --source-field source --target-field target
    deps:
    - path: configs/ranker.json
      md5: 4a1acb650acef81806288659c7e02251
      size: 192
    - path: data/backtrans_toxic2neutral.jsonl
      md5: 197721a920ec8befeb96f5f23b1947ec
      size: 194581989
    - path: rudetox/ranker.py
      md5: 49ba780b9b7c2552f989e6c535155c52
      size: 5680
    outs:
    - path: data/backtrans_toxic2neutral_ranked.jsonl
      md5: 312f5d2cdbaf8c3b99cb144fa548240a
      size: 24504751
  train_reverse_seq2seq:
    cmd:
    - mkdir -p models
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.seq2seq.train --config-path configs/rut5_tox.json
      --train-path data/seq2seq_train.jsonl --val-path data/seq2seq_val.jsonl --out-dir
      models/rut5_tox --source-field "target" --target-field "source"
    - rm -rf models/rut5_tox/checkpoint*
    deps:
    - path: configs/rut5_tox.json
      md5: 90bd0b4f2759e2e59e167ccd217dbb56
      size: 363
    - path: data/seq2seq_train.jsonl
      md5: 144a46ad8ad6f06e755b072ef5ffd087
      size: 2817146
    - path: data/seq2seq_val.jsonl
      md5: c572fa027d28e3de7cd20de539173727
      size: 284908
    - path: rudetox/seq2seq/train.py
      md5: e8d9474ddd2ea539e59399599f64c58e
      size: 5900
    outs:
    - path: models/rut5_tox
      md5: 89f62d6925b821716df010f89c5dbbac.dir
      size: 979502739
      nfiles: 6
  train_marker:
    cmd:
    - python3 -m rudetox.marker.compute_tags data/seq2seq_train.jsonl data/marker_train.jsonl
      --model-name models/rubertconv
    - python3 -m rudetox.marker.compute_tags data/seq2seq_val.jsonl data/marker_val.jsonl
      --model-name models/rubertconv
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.marker.train --train-path data/marker_train.jsonl
      --val-path data/marker_val.jsonl --out-dir models/rubertconv_toxic_marker --config-path
      configs/rubertconv_toxic_marker.json
    - rm -rf models/rubertconv_toxic_marker/checkpoint*
    deps:
    - path: configs/rubertconv_toxic_marker.json
      md5: e518ac6cd3b0c770b5a9f2ff075ce377
      size: 458
    - path: data/seq2seq_train.jsonl
      md5: 144a46ad8ad6f06e755b072ef5ffd087
      size: 2817146
    - path: data/seq2seq_val.jsonl
      md5: c572fa027d28e3de7cd20de539173727
      size: 284908
    - path: models/rubertconv
      md5: 614b2bd67865bec9980a51d7a01a898f.dir
      size: 2859314544
      nfiles: 8
    - path: rudetox/marker/compute_tags.py
      md5: 5aa22c6cd80242bf915ee8602e51f373
      size: 2989
    - path: rudetox/marker/train.py
      md5: d2f960e3f373a141a6e01a7c687e5621
      size: 4813
    outs:
    - path: data/marker_train.jsonl
      md5: 79981825437e685466b94e8c9309e421
      size: 3162261
    - path: data/marker_val.jsonl
      md5: 1dc09d0e111fb6e4f2335e9aef87e4fa
      size: 326957
    - path: models/rubertconv_toxic_marker
      md5: fece67e29cb95f7f7b4948cd694a2f00.dir
      size: 712750389
      nfiles: 6
  predict_reverse_seq2seq:
    cmd:
    - mkdir -p predictions
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.seq2seq.predict --input-file data/neutral.jsonl
      --source-field text --sample-rate 0.03 --output-file data/reverse_neutral2toxic.jsonl
      --model-name models/rut5_tox --num-beams 20 --num-return-sequences 20 --batch-size
      2
    deps:
    - path: data/neutral.jsonl
      md5: 4987f3e05610584f9946d05d54c0b85a
      size: 42736007
    - path: models/rut5_tox
      md5: 89f62d6925b821716df010f89c5dbbac.dir
      size: 979502739
      nfiles: 6
    - path: rudetox/seq2seq/predict.py
      md5: 37fdefec1d4231b58bc2ad0dfbd836f6
      size: 4098
    outs:
    - path: data/reverse_neutral2toxic.jsonl
      md5: afc44012dce3c22ee2217e52cc578339
      size: 47846206
  rank_neutral2toxic_reverse_seq2seq:
    cmd:
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.ranker data/reverse_neutral2toxic.jsonl
      data/reverse_neutral2toxic_ranked.jsonl --config-path configs/inverse_ranker.json
      --source-field text --target-field target
    deps:
    - path: configs/inverse_ranker.json
      md5: e2df0f1ce93954985273b51ca793af9a
      size: 218
    - path: data/reverse_neutral2toxic.jsonl
      md5: afc44012dce3c22ee2217e52cc578339
      size: 47846206
    - path: rudetox/ranker.py
      md5: 7483b81c51456e720ae24227ffb1490a
      size: 5862
    outs:
    - path: data/reverse_neutral2toxic_ranked.jsonl
      md5: 37ddbe269a3e769724631b36042c817c
      size: 5341755
  finalize_neutral2toxic_reverse_seq2seq:
    cmd:
    - python3 -m rudetox.filter data/reverse_neutral2toxic_ranked.jsonl data/reverse_neutral2toxic_final.jsonl
      --config-path configs/inverse_filter.json --source-field target --target-field
      source
    deps:
    - path: configs/inverse_filter.json
      md5: 0ed462d16787b5c493b03639e9b11582
      size: 90
    - path: data/reverse_neutral2toxic_ranked.jsonl
      md5: 37ddbe269a3e769724631b36042c817c
      size: 5341755
    - path: rudetox/filter.py
      md5: 99b5ce9bd58a7975b810ad4b213d95e9
      size: 1780
    outs:
    - path: data/reverse_neutral2toxic_final.jsonl
      md5: 6adf91b565e7505d6096f92810a8f671
      size: 3097042
  finalize_toxic2neutral_backtrans:
    cmd:
    - python3 -m rudetox.filter data/backtrans_toxic2neutral_ranked.jsonl data/backtrans_toxic2neutral_final.jsonl
      --config-path configs/filter.json --source-field source --target-field target
    deps:
    - path: configs/filter.json
      md5: a4f44355257610349a35137914026053
      size: 90
    - path: data/backtrans_toxic2neutral_ranked.jsonl
      md5: 312f5d2cdbaf8c3b99cb144fa548240a
      size: 24504751
    - path: rudetox/filter.py
      md5: 99b5ce9bd58a7975b810ad4b213d95e9
      size: 1780
    outs:
    - path: data/backtrans_toxic2neutral_final.jsonl
      md5: 7b3890966de1e14adf86d9cbb805e9ac
      size: 2735403
  fill_with_marker:
    cmd:
    - CUDA_VISIBLE_DEVICE=0 python3 -m rudetox.marker.fill --model-name models/rubertconv_toxic_marker
      --input-path data/toxic.jsonl --output-path data/marker_toxic2neutral.jsonl
      --filler-model-name models/rubertconv --text-field "text" --filler-model-type
      "mlm" --filler-mask-token "[MASK]"
    deps:
    - path: data/toxic.jsonl
      md5: 5bb0818ee5cb8ae3ab57af9e209bcdc3
      size: 6357161
    - path: models/rubertconv
      md5: 614b2bd67865bec9980a51d7a01a898f.dir
      size: 2859314544
      nfiles: 8
    - path: models/rubertconv_toxic_marker
      md5: fece67e29cb95f7f7b4948cd694a2f00.dir
      size: 712750389
      nfiles: 6
    - path: rudetox/marker/fill.py
      md5: 0a174efb8de4709495fdb36c95af3511
      size: 9044
    outs:
    - path: data/marker_toxic2neutral.jsonl
      md5: 7125c8096101820dbdab376fcca6181b
      size: 1093975720
  rank_toxic2neutral:
    cmd:
    - cat data/backtrans_toxic2neutral.jsonl > data/toxic2neutral.jsonl
    - cat data/marker_toxic2neutral.jsonl >> data/toxic2neutral.jsonl
    - CUDA_VISIBLE_DEVICES=0 python3 -m rudetox.ranker data/toxic2neutral.jsonl data/toxic2neutral_ranked.jsonl
      --config-path configs/ranker.json --source-field source --target-field target
    deps:
    - path: configs/ranker.json
      md5: 4a1acb650acef81806288659c7e02251
      size: 192
    - path: data/backtrans_toxic2neutral.jsonl
      md5: 2bb1f51d31d2e8c5eea9a72ecd360e1f
      size: 210864508
    - path: data/marker_toxic2neutral.jsonl
      md5: 7125c8096101820dbdab376fcca6181b
      size: 1093975720
    - path: rudetox/ranker.py
      md5: 7483b81c51456e720ae24227ffb1490a
      size: 5862
    outs:
    - path: data/toxic2neutral_ranked.jsonl
      md5: b1b7d067791bc3aa8717da32fb882db3
      size: 26296413
  finalize_toxic2neutral:
    cmd:
    - python3 -m rudetox.filter data/toxic2neutral_ranked.jsonl data/toxic2neutral_final.jsonl
      --config-path configs/filter.json --source-field source --target-field target
    deps:
    - path: configs/filter.json
      md5: a4f44355257610349a35137914026053
      size: 90
    - path: data/toxic2neutral_ranked.jsonl
      md5: b1b7d067791bc3aa8717da32fb882db3
      size: 26296413
    - path: rudetox/filter.py
      md5: 99b5ce9bd58a7975b810ad4b213d95e9
      size: 1780
    outs:
    - path: data/toxic2neutral_final.jsonl
      md5: c9e4514be93e8235ef7d0eba942a744b
      size: 11706315
